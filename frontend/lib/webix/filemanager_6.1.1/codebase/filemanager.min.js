/**
 * @license
 * Webix FileManager v.6.1.1
 * This software is covered by Webix Commercial License.
 * Usage without proper license is prohibited.
 * (c) XB Software Ltd.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function n(e){e.attachEvent("onComponentInit",function(){var r,s;(s=(r=e).getMenu())&&(s.attachEvent("onItemClick",function(e,t){var i=this.getItem(e),n=r[i.method]||r[e];if(n){var o=r.getActive();if(r.callEvent("onbefore"+(i.event||i.method||e),[o])){"upload"==e&&r.config.legacyUploader||(r._uploadPopup&&r._uploadPopup.hide(),s.hide());var a=[o];"upload"==e&&(t=webix.html.pos(t),a.push(t)),webix.delay(function(){n.apply(r,a),r.callEvent("onafter"+(i.event||i.method||e),[])})}}}),s.attachEvent("onBeforeShow",function(e){s.filter(""),s.hide();var t=s.getContext();return t&&t.obj&&!t.id&&t.obj.unselectAll(),!t||!t.obj||t.obj.callEvent("onBeforeMenuShow",[t.id,e])}))});var n=e.config.templateName,t={view:"filemenu",id:"actions",width:200,padding:0,autofocus:!1,css:"webix_fmanager_actions",template:function(e,t){var i=n(e,t);return"<span class='webix_fmanager_icon "+(-1==e.icon.indexOf("fm-")?"fa-"+e.icon:e.icon)+"'></span> "+i},data:[{id:"copy",batch:"item",method:"markCopy",icon:"fm-copy",value:webix.i18n.filemanager.copy},{id:"cut",batch:"item",method:"markCut",icon:"fm-cut",value:webix.i18n.filemanager.cut},{id:"paste",method:"pasteFile",icon:"fm-paste",value:webix.i18n.filemanager.paste},{$template:"Separator"},{id:"create",method:"createFolder",icon:"fm-folder",value:webix.i18n.filemanager.create},{id:"remove",batch:"item",method:"deleteFile",icon:"fm-delete",value:webix.i18n.filemanager.remove},{id:"edit",batch:"item",method:"editFile",icon:"fm-edit",value:webix.i18n.filemanager.rename},{id:"upload",method:"uploadFile",event:"UploadDialog",icon:"fm-upload",value:webix.i18n.filemanager.upload}]};e.callEvent("onViewInit",["actions",t]),e._contextMenu=e.ui(t),e.attachEvent("onDestruct",function(){e._contextMenu.destructor()})}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}webix.type(webix.ui.tree,{name:"FileTree",css:"webix_fmanager_tree",dragTemplate:webix.template("#value#"),icon:function(e){for(var t="",i=1;i<e.$level;i++)t+="<div class='webix_tree_none'></div>";return e.webix_child_branch&&!e.$count?t+="<div class='webix_tree_child_branch webix_fmanager_icon webix_tree_close'></div>":0<e.$count?e.open?t+="<div class='webix_fmanager_icon webix_tree_open'></div>":t+="<div class='webix_fmanager_icon webix_tree_close'></div>":t+="<div class='webix_tree_none'></div>",t},folder:function(e){return e.$count&&e.open?"<div class='webix_fmanager_icon webix_folder_open'></div>":"<div class='webix_fmanager_icon webix_folder'></div>"}}),webix.type(webix.ui.dataview,{name:"FileView",css:"webix_fmanager_files",height:110,margin:10,width:150,template:function(e,t){var i=t.templateName(e,t);return"<div class='webix_fmanager_file'><div class='webix_fmanager_data_icon'>"+t.templateIcon(e,t)+"</div>"+i+"</div>"}}),webix.i18n.filemanager={actions:"Actions",back:"Back",forward:"Forward",levelUp:"Level Up",name:"Name",size:"Size",type:"Type",date:"Date",copy:"Copy",cut:"Cut",paste:"Paste",upload:"Upload",remove:"Delete",create:"Create Folder",rename:"Rename",location:"Location",select:"Select Files",sizeLabels:["B","KB","MB","GB"],iconsView:"Icons View",tableView:"Table View",hideTree:"Hide Tree",showTree:"Show Tree",collapseTree:"Collapse Tree",expandTree:"Expand Tree",saving:"Saving...",errorResponse:"Error: changes were not saved!",replaceConfirmation:"The folder already contains files with such names. Would you like to replace existing files ?",createConfirmation:"The folder with such a name already exists. Would you like to replace it ?",renameConfirmation:"The file with such a name already exists. Would you like to replace it ?",yes:"Yes",no:"No",types:{folder:"Folder",doc:"Document",excel:"Excel",pdf:"PDF",pp:"PowerPoint",text:"Text File",video:"Video File",image:"Image",code:"Code",audio:"Audio",archive:"Archive",file:"File"}},webix.protoUI({name:"filelist"},webix.EditAbility,webix.ui.list),webix.protoUI({name:"filemenu"},webix.ContextHelper,webix.ui.submenu),webix.protoUI({name:"filetree",$dragHTML:function(e,t){var i=webix.DragControl.getContext(),n=this.type,o=n.dragTemplate(e,n),a=webix.html.getTextSize(o),r=webix.html.offset(this.$view),s=t.x-r.x;return i.x_offset=s>a.width?-a.width/4:-s,i.y_offset=-a.height/2,"<div class='webix_tree_item webix_fmanager_drag' style='width:auto'>"+o+"</div>"}},webix.EditAbility,webix.ui.tree),webix.protoUI({name:"filetable",$dragHTML:function(e,t){var i=webix.DragControl.getContext(),n=this.getColumnIndex("value"),o=this.config.columns[n].template(e,this.type),a=webix.html.getTextSize(o),r=webix.html.offset(this.$view),s=t.clientX-r.x;i.x_offset=s>a.width?-a.width/4:-s,i.y_offset=-a.height/2;var l="<div class='webix_dd_drag webix_fmanager_drag' >";return(l+="<div style='width:"+(a.width+40)+"px'>"+o+"</div>")+"</div>"}},webix.ui.datatable),webix.protoUI({name:"fileview"},webix.EditAbility,webix.ui.dataview),webix.protoUI({name:"path",defaults:{layout:"x",separator:",",scroll:!1},$skin:function(){this.type.height=webix.skin.$active.buttonHeight||webix.skin.$active.inputHeight},$init:function(){this.$view.className+=" webix_path"},value_setter:function(e){return this.setValue(),e},setValue:function(e){this.clearAll(),e&&("string"==typeof e&&(e=e.split(this.config.separator)),this.parse(webix.copy(e)))},getValue:function(){return this.serialize()}},webix.ui.list);var e={modes:["files","table"],mode:"table",handlers:{},structure:{},fsIds:!0,templateName:webix.template("#value#"),templateSize:function(e){for(var t=e.size,i=webix.i18n.filemanager.sizeLabels,n=0;1<t/1024;)t/=1024,n++;var o=parseInt(t,10)==t;return webix.Number.numToStr({decimalDelimiter:webix.i18n.decimalDelimiter,groupDelimiter:webix.i18n.groupDelimiter,decimalSize:o?0:webix.i18n.groupSize})(t)+""+i[n]},templateType:function(e){var t=webix.i18n.filemanager.types;return t&&t[e.type]?t[e.type]:e.type},templateDate:function(e){var t=e.date;return"object"!=i(t)&&(t=new Date(1e3*parseInt(e.date,10))),webix.i18n.fullDateFormatStr(t)},templateCreate:function(){return{value:"newFolder",type:"folder",date:new Date}},templateIcon:function(e,t){return"<div class='webix_fmanager_icon fm-"+(t.icons[e.type]||t.icons.file)+"'></div>"},uploadProgress:{type:"icon",hide:!1},icons:{folder:"folder",excel:"file-excel",pdf:"file-pdf",pp:"file-powerpoint",text:"file-text",video:"file-video",image:"file-image",code:"file-code",audio:"file-audio",archive:"file-archive",doc:"file-word",file:"file"}};function o(e){e._cursorHistory=webix.extend([],webix.PowerArray,!0),e.$ready.push(function(){return(n=e).attachEvent("onAfterLoad",function(){if(!n.config.disabledHistory){var e=window.location.hash;e&&0===e.indexOf("#!/")&&n.setPath(e.replace("#!/",""))}}),void n.attachEvent("onAfterCursorChange",function(e){var t,i;n._historyIgnore||(n._historyCursor||n._cursorHistory.splice(1),n._cursorHistory[this._historyCursor]!=e&&(20==n._cursorHistory.length&&n._cursorHistory.splice(0,1),n._cursorHistory.push(e),n._historyCursor=this._cursorHistory.length-1)),n._historyIgnore=!1,n.config.disabledHistory||(t=n,i=(i=e)||t.getCursor(),window.history&&window.history.replaceState?window.history.replaceState({webix:!0,id:t.config.id,value:i},"","#!/"+i):window.location.hash="#!/"+i),n.callEvent("onHistoryChange",[e,n._cursorHistory,n._historyCursor])});var n})}function t(e,t){if(1<e._cursorHistory.length){var i=e._historyCursor+t;-1<i&&i<e._cursorHistory.length&&(e._historyIgnore=!0,e._historyCursor=i,e.setCursor(e._cursorHistory[i]))}return e.getCursor()}function f(e,t){for(var i=webix.DataStore.prototype.sorting.create(e),n=[],o=[],a=0;a<t.length;a++)"folder"==t[a].type?n.push(t[a]):o.push(t[a]);return n.sort(i),o.sort(i),n.concat(o)}function a(e){e.attachEvent("onBeforeCursorChange",function(){return!(e.$skipDynLoading=!1)}),e.dataParser={files:function(e,t){this.config.noFileCache?r(this,e.id):e.webix_files=0,s(this,t)},branch:function(e,t){this.config.noFileCache?r(this,e.id):(e.webix_branch=0,e.webix_child_branch=0),s(this,t)}}}function r(t,e){var i=[];t.data.eachChild(e,function(e){t.data.branch[e.id]||"folder"==e.type||i.push(e.id)},t,!0);for(var n=0;n<i.length;n++)t.remove(i[n])}function s(e,t){e.parse(t),e.$skipDynLoading=!0,e._refreshActiveFolder(),e.$skipDynLoading=!1}function c(o,a,r,s){var l=o.getItem(a[0]);o.showProgress();var e=o.config.handlers[r],t={success:function(e,t){o.hideProgress();var i=o.data.driver.toObject(e,t);if(o.callEvent("onBeforeDynParse",[l,i,r])){l.open=!0,o.dataParser[r].call(o,l,i);var n=a.shift();a.length&&"folder"==o.getItem(a[0]).type?c(o,a,r,s):(o.refreshCursor(),s.resolve(n)),o.callEvent("onAfterDynParse",[l,i,r])}}};if(e.load)return e.load(null,t,{action:r,source:a[0]})}function l(e){for(var t in e.dataParser)if(e.config.handlers[t])return t;return null}function u(e,t){e.callEvent("onShowSearchResults",[]),e.$searchResults=!0;var i=e.$$(e.config.mode);i&&i.filter&&(i.clearAll(),e.sortState&&e.sortState.view==i.config.id&&(t=f(e.sortState.sort,t)),i.parse(t))}function d(e){var t,i,n=[];if("string"==typeof e)for(i=e.replace(/^\//,"").split("/"),t=0;t<i.length;t++)n.push(i.slice(0,t+1).join("/"));return n}function h(o,e,a,r){if(o.callEvent("onBeforeRequest",[e,a])&&(v(o),e.load)){var t={success:function(e,t){var i,n=o.data.driver.toObject(e,t);(i=o)._saveMessage&&(webix.html.remove(i._saveMessage),i._saveMessage=null),o.callEvent("onSuccessResponse",[a,n])&&r&&r.call(o,a,n)},error:function(e){o.callEvent("onErrorResponse",[a,e])&&g(o)}};e.load(null,t,webix.copy(a))}}function v(e,t){e._saveMessageDate=new Date,e._saveMessage||(e._saveMessage=webix.html.create("DIV",{class:"webix_fmanager_save_message"},""),e.$view.style.position="relative",webix.html.insertBefore(e._saveMessage,e.$view));var i="";i=t?webix.i18n.filemanager.errorResponse:webix.i18n.filemanager.saving,e._saveMessage.innerHTML=i}function g(n){var o=n.data.url;if(o){var a=n.data.driver;v(n,!0),webix.ajax().get(o,{success:function(e,t){var i=a.toObject(e,t);i&&(i=a.getDetails(a.getRecords(i)),n.clearAll(),n.parse(i),n.data.url=o)},error:function(){}})}}function p(e,t){return e.attachEvent("onComponentInit",function(){return function(t){var e,i,n=t.$$(t.config.mode),o=t.config.modes;n&&(n.show(),t.attachEvent("onBeforeCursorChange",function(){var e=t.$$(t.config.mode);return e&&e.unselect(),!0}),t.attachEvent("onAfterCursorChange",function(){var e=t.$$(t.config.mode);e&&e.editStop()}));if(o)for(e=0;e<o.length;e++)(i=t.$$(o[e]))&&i.filter&&m(t,i)}(e)}),{animate:!1,cells:t.modes?webix.copy(t.modes):[]}}function m(e,t){var c,u,i,n,o,a;u=t,(c=e).data.attachEvent("onClearAll",function(){return u.clearAll()}),c.data.attachEvent("onIdChange",function(e,t){u.data.pull[e]&&u.data.changeId(e,t)}),u.attachEvent("onBeforeSelect",function(){u.$skipBinding=!0}),c.attachEvent("onBeforeCursorChange",function(){u.$skipBinding=!1}),c.attachEvent("onAfterCursorChange",function(){u.$skipBinding=!1}),u.bind(c,"$data",function(e,t){var i,n,o,a,r,s;if(u.$skipBinding)return!1;if(!e)return u.clearAll();if(!c.$searchResults){if(!c.$skipDynLoading)for(var l in c.dataParser)!i&&e["webix_"+l]&&(i=c.config.handlers[l])&&(c.$skipDynLoading=!0,c.loadDynData(i,e,l));n=c,o=u,a=t,r=e,s=[].concat(webix.copy(a.data.getBranch(r.id))).concat(r.files||[]),n.sortState&&n.sortState.view==o.config.id&&(s=f(n.sortState.sort,s)),o.data.importData(s,!0)}}),i=e,(n=t).type.icons=i.config.icons,n.type.templateIcon=i.config.templateIcon,n.type.templateName=i.config.templateName,n.type.templateSize=i.config.templateSize,n.type.templateDate=i.config.templateDate,n.type.templateType=i.config.templateType,o=e,(a=t).attachEvent("onAfterSelect",function(e){o.getItem(e)&&o.callEvent("onItemSelect",[e])}),a.attachEvent("onItemDblClick",function(e){o._onFileDblClick(e)}),o._addElementHotKey("tab",function(e){if(!e.getSelectedId()){var t=e.getFirstId();t&&e.select(t)}},a),a.attachEvent("onFocus",function(){o._activeView=this,webix.html.removeCss(this.$view,"webix_blur")}),a.attachEvent("onBlur",function(){o.getMenu()&&o.getMenu().isVisible()||webix.html.addCss(a.$view,"webix_blur")}),a.attachEvent("onBeforeEditStop",function(e,t){return this.getTopParentView().callEvent("onBeforeEditStop",[t.id||t.row,e,t,this])}),a.attachEvent("onAfterEditStop",function(e,t){var i=this.getTopParentView();i.callEvent("onAfterEditStop",[t.id||t.row,e,t,this])&&(t.column&&"value"!=t.column?t.column&&(i.getItem(t.id||t.row)[t.column]=e.value):i.renameFile(t.id||t.row,e.value))}),a.attachEvent("onBeforeDrop",function(e,t){return o.callEvent("onBeforeDrop",[e])&&e.from&&(o.moveFile(e.source,e.target),o.callEvent("onAfterDrop",[e,t])),!1}),a.attachEvent("onBeforeDrag",function(e,t){return!o.config.readonly&&o.callEvent("onBeforeDrag",[e,t])}),a.attachEvent("onBeforeDragIn",function(e,t){return!o.config.readonly&&o.callEvent("onBeforeDragIn",[e,t])}),o._addElementHotKey("enter",function(e){for(var t=e.getSelectedId(!0),i=0;i<t.length;i++)o._onFileDblClick(t[i]);if(webix.UIManager.setFocus(e),!(t=e.getSelectedId(!0)).length){var n=e.getFirstId();n&&e.select(n)}},a);var r,s,l,d=e.getMenu();d&&!e.config.readonly&&(r=e,l=d,(s=t).on_context.webix_view=function(e,t){this.locate(e.target||e.srcElement)||(l.setContext&&l.setContext({obj:webix.$$(e)}),l.show(e),webix.html.preventEvent(e))},l.attachTo(s),s.attachEvent("onBeforeMenuShow",function(){var e=l.getContext(),i="";if(e.id&&(i="folder"===r.getItem(e.id).type?"folder":"file"),l.filter(function(e){var t=!0;return e.batch&&(t=i?e.batch==i||"item"==e.batch:"empty"==e.batch),r.config.menuFilter&&(t=t&&r.config.menuFilter(e)),t}),l.count()&&e.id){webix.UIManager.setFocus(this);var t=this.getSelectedId(),n=!1;if(webix.isArray(t))for(var o=0;!n&&o<t.length;o++)""+t[o]==""+e.id&&(n=!0);!n&&this.exists(e.id)&&this.select(e.id)}return 0<l.count()}),s.attachEvent("onAfterMenuShow",function(e){if(e){for(var t=this.getSelectedId(!0),i=!1,n=0;n<t.length&&!i;n++)t[n].toString()==e.toString()&&(i=!0);i||this.select(e.toString()),webix.UIManager.setFocus(this)}else this.unselect()})),e.config.readonly&&(t.define("drag",!1),t.define("editable",!1))}function w(e){return e.attachEvent("onComponentInit",function(){var o;(o=e).$$("table")&&(o.attachEvent("onHideSearchResults",function(){o.$$("table").isColumnVisible("location")&&o.$$("table").hideColumn("location")}),o.attachEvent("onShowSearchResults",function(){o.$$("table").isColumnVisible("location")||o.$$("table").showColumn("location")}),o.$$("table").attachEvent("onBeforeEditStart",function(e){return"object"==i(e)||(this.edit({row:e,column:"value"}),!1)}),o.$$("table").data.attachEvent("onBeforeSort",function(e,t,i,n){if(o.sortState={view:o.$$("table").config.id,sort:n},o.$searchResults&&o.$$("search"))return o.showSearchResults(o.$$("search").getValue()),!1}),o.data.attachEvent("onClearAll",function(){o.sortState=null}))}),{view:"filetable",css:"webix_fmanager_table",columns:"columns",headerRowHeight:34,editable:!0,editaction:!1,select:"multiselect",drag:!0,navigation:!0,resizeColumn:!0,tabFocus:!0,onContext:{}}}function b(t){return t.attachEvent("onComponentInit",function(){var e;(e=t).$$("hideTree")&&e.$$("hideTree").attachEvent("onItemClick",function(){e.hideTree()})}),{view:"button",type:"htmlbutton",css:"webix_fmanager_toggle",label:'<div class="webix_fmanager_bar_icon "></div>',width:30,tooltip:webix.i18n.filemanager.hideTree}}function x(e){return e.attachEvent("onComponentInit",function(){return function(o){var n,a=o.$$("tree");if(a){a.type.icons=o.config.icons,a.sync(o,function(){this.filter(function(e){return e.$count||"folder"==e.type})}),a.on_click.webix_tree_child_branch=function(e,t){var i=o.config.handlers.branch;i&&o.loadDynData(i,this.getItem(t),"branch",!0)},o.attachEvent("onBeforeDynParse",function(){n=a.getState()}),o.attachEvent("onAfterDynParse",function(e,t,i){n&&(a.setState(n),n=null),"branch"==i&&e.open&&a.open(e.id)}),a.attachEvent("onAfterSelect",function(e){o.callEvent("onFolderSelect",[e])}),o.attachEvent("onAfterCursorChange",function(e){e&&(a.select(e),a.showItem(e))}),a.attachEvent("onItemClick",function(){o.$searchResults&&o.hideSearchResults()}),o.attachEvent("onItemRename",function(e){a.refresh(e)}),a.attachEvent("onItemDblClick",function(e){this.isBranchOpen(e)?this.close(e):this.open(e)}),a.attachEvent("onBlur",function(){o.getMenu()&&o.getMenu().isVisible()||webix.html.addCss(this.$view,"webix_blur")}),a.attachEvent("onFocus",function(){o._activeView=a,webix.html.removeCss(a.$view,"webix_blur"),o.$$(o.config.mode).unselect()}),o.attachEvent("onPathComplete",function(e){a.showItem(e)}),o.config.readonly||(o.getMenu()&&o.getMenu().attachTo(a),a.attachEvent("onBeforeMenuShow",function(e){var t=o.getMenu(),i=t.getContext(),n="";return i.id&&this.getParentId(i.id)&&(n="folder"===o.getItem(i.id).type?"folder":"file"),t.filter(function(e){var t=!0;return e.batch&&(t=n?e.batch==n||"item"==e.batch:"empty"==e.batch),o.config.menuFilter&&(t=t&&o.config.menuFilter(e)),t}),this.select(e),webix.UIManager.setFocus(this),0<t.count()})),a.attachEvent("onBeforeEditStop",function(e,t){return o.callEvent("onBeforeEditStop",[t.id,e,t,a])}),a.attachEvent("onAfterEditStop",function(e,t){o.callEvent("onAfterEditStop",[t.id,e,t,a])&&o.renameFile(t.id,e.value)}),a.attachEvent("onBeforeDrag",function(e,t){return!o.config.readonly&&o.callEvent("onBeforeDrag",[e,t])}),a.attachEvent("onBeforeDragIn",function(e,t){return!o.config.readonly&&o.callEvent("onBeforeDragIn",[e,t])}),a.attachEvent("onBeforeDrop",function(e,t){return o.callEvent("onBeforeDrop",[e,t])&&e.from&&(o.moveFile(e.source,e.target),o.callEvent("onAfterDrop",[e,t])),!1});var e=function(){a&&webix.UIManager.setFocus(a)};o.attachEvent("onAfterBack",e),o.attachEvent("onAfterForward",e),o.attachEvent("onAfterLevelUp",e),o.attachEvent("onAfterPathClick",e),o.config.readonly&&(a.define("drag",!1),a.define("editable",!1))}}(e)}),{width:251,view:"filetree",id:"tree",select:!0,filterMode:{showSubItems:!1,openParents:!1},type:"FileTree",navigation:!0,editor:"text",editable:!0,editaction:!1,drag:!0,tabFocus:!0,onContext:{}}}function _(n,e){var t,i,o,a,r,s,l,c,u,d,f,h;n.structure={mainLayout:(h={type:"clean",rows:["toolbar","bodyLayout"]},"undefined"==typeof SVGRect&&(h.css="webix_nosvg"),h),toolbar:{css:"webix_fmanager_toolbar",paddingX:10,paddingY:5,margin:7,cols:["menu",{id:"menuSpacer",width:75},{margin:0,cols:["back","forward"]},"up","path","search","modes"]},menu:(f=n,f.attachEvent("onComponentInit",function(){var e,t;(t=(e=f).$$("menu"))&&(t.attachEvent("onItemClick",function(){e.callEvent("onBeforeMenu",[])&&(e.getMenu().setContext({obj:e.getActiveView(),id:e.getActive()}),e.getMenu().show(t.$view),e.callEvent("onAfterMenu",[]))}),e.config.readonly&&(t.hide(),e.$$("menuSpacer")&&e.$$("menuSpacer").hide()))}),{view:"button",type:"htmlbutton",label:'<div class="webix_fmanager_bar_icon "></div>',css:"webix_fmanager_menu",icon:"bars",width:37,tooltip:webix.i18n.filemanager.actions}),back:(d=n,d.attachEvent("onComponentInit",function(){var n;(n=d).$$("back")&&(n.$$("back").attachEvent("onItemClick",function(){n.callEvent("onBeforeBack",[])&&(n.goBack(),n.callEvent("onAfterBack",[]))}),n.attachEvent("onHistoryChange",function(e,t,i){i?n.$$("back").enable():n.$$("back").disable()}))}),{view:"button",type:"htmlbutton",css:"webix_fmanager_back",label:'<div class="webix_fmanager_bar_icon "></div>',width:37,tooltip:webix.i18n.filemanager.back}),forward:(u=n,u.attachEvent("onComponentInit",function(){var n;(n=u).$$("forward")&&(n.$$("forward").attachEvent("onItemClick",function(){n.callEvent("onBeforeForward",[])&&(n.goForward(),n.callEvent("onAfterForward",[]))}),n.attachEvent("onHistoryChange",function(e,t,i){1==t.length||i==t.length-1?n.$$("forward").disable():n.$$("forward").enable()}))}),{view:"button",type:"htmlbutton",css:"webix_fmanager_forward",label:'<div class="webix_fmanager_bar_icon "></div>',width:37,tooltip:webix.i18n.filemanager.forward}),up:(c=n,c.attachEvent("onComponentInit",function(){var e;(e=c).$$("up")&&e.$$("up").attachEvent("onItemClick",function(){e.callEvent("onBeforeLevelUp",[])&&(e.levelUp(),e.callEvent("onAfterLevelUp",[]))})}),{view:"button",type:"htmlbutton",css:"webix_fmanager_up",label:'<div class="webix_fmanager_bar_icon "></div>',width:37,tooltip:webix.i18n.filemanager.levelUp}),path:(l=n,l.attachEvent("onComponentInit",function(){var n;(n=l).$$("path")&&(n.attachEvent("onFolderSelect",function(e){n.$$("path").setValue(n.getPathNames(e))}),n.$$("path").attachEvent("onItemClick",function(e){var t=n.$$("path").getIndexById(e),i=n.$$("path").count()-t-1;if(n.$searchResults&&n.hideSearchResults(),i){for(e=n.getCursor();i;)e=n.getParentId(e),i--;n.setCursor(e)}n.callEvent("onAfterPathClick",[e])}),n.data.attachEvent("onClearAll",function(){n.$$("path").clearAll()}))}),{view:"path",borderless:!0}),search:(s=n,s.attachEvent("onComponentInit",function(){var t,i;(i=(t=s).$$("search"))&&(t.attachEvent("onHideSearchResults",function(){i.setValue("")}),t.attachEvent("onBeforeCursorChange",function(){t.$searchResults&&t.hideSearchResults(!0)}),i.attachEvent("onTimedKeyPress",function(){if(9!=this._code){var e=i.getValue();e?t.callEvent("onBeforeSearch",[e])&&(t.showSearchResults(e),t.callEvent("onAfterSearch",[e])):t.$searchResults&&t.hideSearchResults()}}),i.attachEvent("onKeyPress",function(e){this._code=e}),t.attachEvent("onAfterModeChange",function(){t.$searchResults&&t.showSearchResults(i.getValue())}))}),{view:"search",gravity:.3,minWidth:80,css:"webix_fmanager_search",icon:" webix_fmanager_icon"}),bodyLayout:{css:"webix_fmanager_body",cols:["sidePanel","treeLayout",{view:"resizer",id:"resizer",width:3},"modeViews"]},treeLayout:{rows:["treeToolbar","tree"]},sidePanel:(r=n,r.attachEvent("onComponentInit",function(){var e;(e=r).$$("showTree")&&e.$$("showTree").attachEvent("onItemClick",function(){e.showTree()})}),{hidden:!0,css:"webix_fmanager_panel",type:"clean",rows:[{height:34,paddingY:1,paddingX:0,view:"form",cols:[{view:"button",id:"showTree",type:"htmlbutton",css:"webix_fmanager_toggle",label:'<div class="webix_fmanager_bar_icon "></div>',width:30,tooltip:webix.i18n.filemanager.showTree}]},{template:" "}]}),treeToolbar:{css:"webix_fmanager_tree_toolbar",height:34,paddingX:8,paddingY:1,margin:7,cols:["hideTree",{id:"treeSpacer"},"expandAll","collapseAll"]},showTree:b(n),hideTree:b(n),expandAll:(a=n,a.attachEvent("onComponentInit",function(){return(e=a)._getDynMode()&&e.$$("expandAll")&&e.$$("expandAll").hide(),void(e.$$("expandAll")&&e.$$("tree")&&e.$$("expandAll").attachEvent("onItemClick",function(){e.$$("tree").openAll()}));var e}),{view:"button",type:"htmlbutton",css:"webix_fmanager_expand",label:'<div class="webix_fmanager_bar_icon "></div>',width:30,tooltip:webix.i18n.filemanager.expandTree}),collapseAll:(o=n,o.attachEvent("onComponentInit",function(){return(e=o)._getDynMode()&&e.$$("collapseAll")&&e.$$("collapseAll").hide(),void(e.$$("collapseAll")&&e.$$("tree")&&e.$$("collapseAll").attachEvent("onItemClick",function(){e.$$("tree").closeAll()}));var e}),{view:"button",type:"htmlbutton",css:"webix_fmanager_collapse",label:'<div class="webix_fmanager_bar_icon "></div>',width:30,tooltip:webix.i18n.filemanager.collapseTree}),tree:x(n),modeViews:{config:function(e){return p(n,e)}},modes:{config:function(e){return i=e,(t=n).attachEvent("onComponentInit",function(){var i;(i=t).$$("modes")&&i.$$("modes").attachEvent("onBeforeTabClick",function(e){var t=i.$$("modes").getValue();return!(!i.callEvent("onBeforeModeChange",[t,e])||!i.$$(e)||(i.config.mode=e,i.$$(e).show(),i.callEvent("onAfterModeChange",[t,e]),0))})}),{view:"segmented",width:70,options:[{id:"files",width:32,value:'<div class="webix_fmanager_bar_icon webix_fmanager_files_mode "></div>',tooltip:webix.i18n.filemanager.iconsView},{id:"table",width:32,value:'<div class="webix_fmanager_bar_icon webix_fmanager_table_mode "></div>',tooltip:webix.i18n.filemanager.tableView}],css:"webix_fmanager_modes",value:i.mode};var t,i}},files:{config:{view:"fileview",type:"FileView",select:"multiselect",editable:!0,editaction:!1,editor:"text",editValue:"value",drag:!0,navigation:!0,tabFocus:!0,onContext:{}}},table:{config:w(n)},columns:{config:(t=n,i=webix.i18n.filemanager,[{id:"value",header:i.name,fillspace:3,sort:"string",template:function(e,t){var i=t.templateName(e,t);return t.templateIcon(e,t)+i},editor:"text"},{id:"date",header:i.date,fillspace:2,sort:"int",template:function(e,t){return t.templateDate(e,t)}},{id:"type",header:i.type,fillspace:1,sort:"string",template:function(e,t){return t.templateType(e)}},{id:"size",header:i.size,fillspace:1,sort:"int",css:{"text-align":"right"},template:function(e,t){return"folder"==e.type?"":t.templateSize(e)}},{id:"location",header:i.location,fillspace:2,sort:"string",template:function(e){return t._getLocation(e)},hidden:!0}])}},function(e,t){var i,n,o=t.structure;if(o)for(n in o)o.hasOwnProperty(n)&&(i=webix.copy(o[n]),e.structure[n]&&e.structure[n].config?e.structure[n].config=i.config||i:e.structure[n]=i.config||i)}(n,e)}function y(e,t,i){var n=t.config||t;return"function"==typeof n?n.call(e,i):webix.copy(n)}function $(e,t){var i=e.structure.mainLayout,n=webix.extend({},i.config||i);return function e(t,i,n){var o,a,r,s,l="",c=["rows","cols","elements","cells","columns","options","data"];for(r=0;r<c.length;r++)i[c[r]]&&(o=i[l=c[r]]);if(o)for("string"==typeof o&&t.structure[o]&&(i[l]=y(t,t.structure[o],n),o=i[l]),r=0;r<o.length;r++)a=null,"string"==typeof o[r]&&(a=s=o[r],t.structure[s]?(o[r]=y(t,webix.extend({},t.structure[s]),n),o[r].id=s):o[r]={}),e(t,o[r],n),a&&(n.on&&n.on.onViewInit&&n.on.onViewInit.apply(this,[a,o[r]]),webix.callEvent("onViewInit",[a,o[r],this]))}(e,n,t),t.on&&t.on.onViewInit&&t.on.onViewInit.apply(e,[t.id||"mainLayout",n]),webix.callEvent("onViewInit",[t.id||"mainLayout",n,e]),"undefined"==typeof SVGRect&&(t.css=t.css?t.css+" webix_nosvg":"webix_nosvg"),n}function E(e){return e?{view:"uploader",css:"webix_upload_select_ie",type:"iconButton",icon:"check",label:webix.i18n.filemanager.select,formData:{action:"upload"},urlData:{}}:{view:"uploader",apiOnly:!0,formData:{action:"upload"},urlData:{}}}function I(n){var o=S(n);if(o){o.config.upload=n.config.handlers.upload;var e=n.config.modes;if(e&&!n.config.readonly)for(var t=0;t<e.length;t++)n.$$(e[t])&&o.addDropZone(n.$$(e[t]).$view);o.attachEvent("onBeforeFileAdd",function(e){var t,i=""+((t=n)._uploaderFolder||t.getCursor());return o.config.formData.target=i,o.config.urlData.target=i,o.config.upload=n.config.handlers.upload,n.callEvent("onBeforeFileUpload",[e])}),o.attachEvent("onAfterFileAdd",function(e){n._uploaderFolder=null,e.oldId=e.id,n.add({id:e.id,value:e.name,type:e.type,size:e.size,date:Math.round((new Date).valueOf()/1e3)},-1,o.config.formData.target),n.config.uploadProgress&&n.showProgress(n.config.uploadProgress),n._refreshActiveFolder()}),o.attachEvent("onUploadComplete",function(e){n._uploadPopup&&(n.getMenu().hide(),n._uploadPopup.hide()),n.hideProgress(),n.callEvent("onAfterFileUpload",[e])}),o.attachEvent("onFileUpload",function(e){e.oldId&&n.data.changeId(e.oldId,e.id),e.value&&(n.getItem(e.id).value=e.value),n.getItem(e.id).type=e.type,n._refreshActiveFolder()}),o.attachEvent("onFileUploadError",function(e,t){g(n),n.hideProgress()})}}function C(e,t){t||(t=E(e.config.legacyUploader)),e._uploadPopup=webix.ui({view:"popup",padding:0,width:250,body:t}),e._uploader=e._uploadPopup.getBody(),e.attachEvent("onDestruct",function(){e._uploadPopup.destructor()})}function S(e){return e._uploader}webix.protoUI({name:"filemanager",$init:function(e){var t=this;this.$view.className+=" webix_fmanager",webix.extend(this.data,webix.TreeStore,!0),this.data.provideApi(this,!0),webix.extend(e,this.defaults),_(this,e),o(this),a(this),e.legacyUploader=e.legacyUploader||webix.isUndefined(XMLHttpRequest)||webix.isUndefined((new XMLHttpRequest).upload),this.$ready.push(function(){t._beforeInit(),t.callEvent("onComponentInit",[])}),webix.UIManager.tabControl=!0,webix.extend(e,$(this,e)),this.attachEvent("onAfterLoad",function(){var e=this;if(!this.getCursor||!this.getCursor()){var t=this.config.defaultSelection;t=t?t.call(this):this.getFirstChildId(0),this.setCursor?this.setCursor(t):this.attachEvent("onComponentInit",function(){e.setCursor(t)})}})},handlers_setter:function(e){for(var t in e){var i=e[t];if("string"==typeof i)if(-1!=i.indexOf("->")){var n=i.split("->");i=webix.proxy(n[0],n[1])}else"upload"!=t&&"download"!=t&&(i=webix.proxy("post",i));e[t]=i}return e},_beforeInit:function(){var e,t,i;n(this),t=(e=this).config.legacyUploader,(i=E(t))&&(t?C(e,webix.copy(i)):(e._uploader=webix.ui(i),e.attachEvent("onDestruct",function(){e._uploader.destructor()}))),I(e),this.config.scheme||this.define("scheme",{init:function(e){var t=this.getItem(e.id);t&&t.$count&&(e.type="folder")}}),this.attachEvent("onFolderSelect",function(e){this.setCursor(e)}),this.attachEvent("onBeforeDragIn",function(e){var t=e.target;if(t)for(var i=e.source,n=0;n<i.length;n++)for(;t;){if(t==i[n])return!1;t=this._getParentId(t)}return!0})},_getParentId:function(e){if(this.getItem(e))return webix.TreeStore.getParentId.apply(this,arguments);var t=this.$$(this.config.mode).getItem(e);return t&&t.parent&&this.getItem(t.parent)?t.parent:null},getMenu:function(){return this._contextMenu},getPath:function(e){return function(e,t){t=t||e.getCursor();for(var i=[];t&&e.getItem(t);)i.push(t),t=e.getParentId(t);return i.reverse()}(this,e)},getPathNames:function(e){return function(e,t){t=t||e.getCursor();for(var i=null,n=[];t&&e.getItem(t);)i=e.getItem(t),n.push({id:t,value:e.config.templateName(i)}),t=e.getParentId(t);return n.reverse()}(this,e)},setPath:function(e){return function(e,t){for(var i=t;i&&e.getItem(i);)e.callEvent("onPathLevel",[i]),i=e.getParentId(i);if(e.getItem(t))t!=e.getCursor()&&(e.setCursor(t),e.callEvent("onPathComplete",[t]));else{var n=d(t);e.openFolders(n).then(function(){e.setCursor(t),e.callEvent("onPathComplete",[t])})}}(this,e)},_getLocation:function(e){var t,i="";if(this.getItem(e.id)||e.parent&&this.getItem(e.parent)){e.parent?(t=this.getPathNames(e.parent)).shift():((t=this.getPathNames(e.id)).shift(),t.pop());for(var n=[],o=0;o<t.length;o++)n.push(t[o].value);i="/"+n.join("/")}else if(e.location)i=e.location;else if("string"==typeof e.id){var a=e.id.split("/");a.pop(),i="/"+a.join("/")}return i},getSearchData:function(e,t){var i=[];return this.data.each(function(e){0<=this.config.templateName(e).toLowerCase().indexOf(t.toLowerCase())&&i.push(webix.copy(e))},this,!0,e),i},showSearchResults:function(e){var t=this.getCursor();this.config.handlers.search?function(n,e,t,o){var i={action:"search",source:t,text:o};if(n.callEvent("onBeforeSearchRequest",[t,i])){var a={success:function(e,t){n.hideProgress();var i=n.data.driver.toObject(e,t);u(n,i),n.$searchValue=o},error:function(){n.hideProgress()}};if(e.load)e.load(null,a,i)}}(this,this.config.handlers.search,t,e):u(this,this.getSearchData(t,e))},hideSearchResults:function(e){if(this.$searchResults&&(this.callEvent("onHideSearchResults",[]),this.$searchResults=!1,!e)){var t=this.getCursor();this.blockEvent(),this.setCursor(null),this.unblockEvent(),this.setCursor(t)}},goBack:function(e){return t(this,e=e?-1*Math.abs(e):-1)},goForward:function(e){return t(this,e||1)},levelUp:function(e){(e=e||this.getCursor())&&(e=this.getParentId(e),this.setCursor(e))},markCopy:function(e){e&&(webix.isArray(e)||(e=[e]),this._moveData=e,this._copyFiles=!0)},markCut:function(e){e&&(webix.isArray(e)||(e=[e]),this._moveData=e,this._copyFiles=!1)},pasteFile:function(e){if(webix.isArray(e)&&(e=e[0]),e){e=e.toString();var t=this.getActiveView().getItem(e);(this.data.branch[e]&&"folder"==this.getItem(e).type||t&&"folder"==t.type)&&this._moveData&&(this._copyFiles?this.copyFile(this._moveData,e):this.moveFile(this._moveData,e))}},download:function(e){var t=this.config.handlers.download;t&&webix.send(t,{action:"download",source:e})},fileExists:function(t,e,i){var n=!1;return this.data.eachChild(e,webix.bind(function(e){t!=e.value||i&&e.id==i||(n=e.id)},this)),n},_refreshActiveFolder:function(){this.$skipDynLoading=!0,this.$$(this.config.mode).$skipBinding=!1,this.refreshCursor()},_setFSId:function(e){var t=this.getParentId(e.id)+"/"+e.value;e.id!=t&&this.data.changeId(e.id,t)},_changeChildIds:function(e){this.data.eachSubItem(e,webix.bind(function(e){e.value&&this._setFSId(e)},this))},_callbackRename:function(e,t){var i=this.getItem(e);i.value!=t&&(i.value=t,this.$$("tree").updateItem(e,{value:t}),this._refreshActiveFolder(),this.callEvent("onItemRename",[e]))},_moveFile:function(e,t,i){var n=i?"copy":"move",o=[];e.reverse();for(var a=0;a<e.length;a++)if(this.getItem(e[a])){var r=this.move(e[a],0,this,{parent:t,copy:!!i});o.push(r)}this._refreshActiveFolder();var s=this.config.handlers[n];s&&h(this,s,{action:n,source:e.join(","),temp:o.join(","),target:t.toString()},function(e,t){if(t&&webix.isArray(t))for(var i=e.temp.split(","),n=0;n<t.length;n++)t[n].id&&t[n].id!=i[n]&&this.data.pull[i[n]]&&(this.data.changeId(i[n],t[n].id),this.config.fsIds&&this._changeChildIds(t[n].id),t[n].value&&this._callbackRename(t[n].id,t[n].value));this._updateDynSearch()})},_updateDynSearch:function(){this.$searchResults&&this.$searchValue&&this.showSearchResults(this.$searchValue)},copyFile:function(e,t){this.moveFile(e,t,!0)},moveFile:function(e,t,i){var n,o,a;for("string"==typeof e&&(e=e.split(",")),webix.isArray(e)||(e=[e]),t?this.data.branch[t]||"folder"==this.getItem(t.toString()).type||(t=this.getParentId(t)):t=this.getCursor(),a=!0,t=t.toString(),n=0;n<e.length;n++)o=e[n].toString(),a=a&&this._isMovingAllowed(o,t);a?this._moveFile(e,t,!!i):this.callEvent(i?"onCopyError":"onMoveError",[])},deleteFile:function(e,t){"string"==typeof e&&(e=e.split(",")),webix.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var n=e[i];this.$$(this.config.mode).isSelected(n)&&this.$$(this.config.mode).unselect(n),n==this.getCursor()&&this.setCursor(this.getFirstId()),n&&this.remove(n)}this._refreshActiveFolder();var o=this.config.handlers.remove;o?(t&&(t=webix.bind(t,this)),h(this,o,{action:"remove",source:e.join(",")},t)):t&&t.call(this)},_createFolder:function(e,t){this.add(e,0,t),e.source=e.value,e.target=t,this._refreshActiveFolder();var i=this.config.handlers.create;i&&(e.action="create",h(this,i,e,function(e,t){t.id&&(e.id!=t.id&&this.data.changeId(e.id,t.id),this.config.fsIds&&this._changeChildIds(t.id),t.value&&this._callbackRename(t.id,t.value))}))},createFolder:function(e){if("string"==typeof e&&(e=e.split(",")),webix.isArray(e)&&(e=e[0]),e){e=""+e;var t=this.getItem(e);this.data.branch[e]||"folder"==t.type||(e=this.getParentId(e));var i=this.config.templateCreate(t);e=""+e,this._createFolder(i,e)}},editFile:function(e){webix.isArray(e)&&(e=e[0]),this.getActiveView()&&this.getActiveView().edit&&this.getActiveView().edit(e)},renameFile:function(e,t,i){var n=this.getItem(e);i=i||"value",n&&(n[i]=t),this.refresh(n?e:""),this._refreshActiveFolder(),this.callEvent("onFolderSelect",[this.getCursor()]);var o=this.config.handlers.rename;o&&h(this,o,{source:e,action:"rename",target:t},function(e,t){t.id&&this.getItem(e.source)&&(e.source!=t.id&&this.data.changeId(e.source,t.id),this.config.fsIds&&this._changeChildIds(t.id),t.value&&this._callbackRename(t.id,t.value)),this._updateDynSearch()})},_isMovingAllowed:function(e,t){for(;t;){if(t==e||!this.data.branch[t]&&"folder"!=this.getItem(t.toString()).type)return!1;t=this.getParentId(t)}return!0},getActiveView:function(){return this._activeView||this.$$("tree")||null},getActive:function(){var e=this.getSelectedFile();return e||this.getCursor()},getCurrentFolder:function(){return this.$$("tree").getSelectedId()},getSelectedFile:function(){var e=null,t=this.$$(this.config.mode).getSelectedId();if(t)if(webix.isArray(t)){e=[];for(var i=0;i<t.length;i++)e.push(t[i].toString())}else e=t.toString();return e},_openFolder:function(e){this.callEvent("onBeforeLevelDown",[e])&&(this.setCursor(e),this.callEvent("onAfterLevelDown",[e]))},_runFile:function(e){this.callEvent("onBeforeRun",[e])&&(this.download(e),this.callEvent("onAfterRun",[e]))},_onFileDblClick:function(e){e=e.toString();var t=this.getItem(e);if(t)this.data.branch[e]||"folder"==t.type?this._openFolder(e):this._runFile(e);else if(this.$$(this.config.mode).filter)if("folder"!=(t=this.$$(this.config.mode).getItem(e)).type)this._runFile(e);else{var i=t&&t.parents?t.parents:d(e);i.length&&this.openFolders(i).then(webix.bind(function(){this._openFolder(e)},this))}},openFolders:function(e){return function(e,t){var i,n,o,a=webix.promise.defer();if((i=l(e))&&t.length){for(n=0;n<t.length;n++){if(!(o=e.getItem(t[n]))||o["webix_"+i])return c(e,t.slice(n),i,a),a;o.open=!0,e.$$("tree")&&e.$$("tree").refresh(t[n])}a.resolve(t[n])}else a.reject();return a}(this,e)},_addElementHotKey:function(e,t,i){var n=webix.UIManager.addHotKey(e,t,i);(i||this).attachEvent("onDestruct",function(){webix.UIManager.removeHotKey(n,t,i)})},clearBranch:function(e){r(this,e)},parseData:function(e){s(this,e)},_getDynMode:function(){return l(this)},loadDynData:function(e,t,i,n){!function(n,e,o,a,r){if(n.showProgress(),n.callEvent("onBeforeDynLoad",[e,o,a,r])){var t={success:function(e,t){n.hideProgress();var i=n.data.driver.toObject(e,t);r&&(o.open=!0),n.callEvent("onBeforeDynParse",[o,i,a])&&(n.dataParser[a].call(n,o,i),n.callEvent("onAfterDynParse",[o,i,a]))},error:function(){n.hideProgress(),n.callEvent("onDynLoadError",[])}};if(e.load)e.load(null,t,{action:a,source:o.id})}}(this,e,t,i,n)},getUploader:function(){return S(this)},uploadFile:function(e,t){return n=e,o=t,(i=this).data.branch[n]||"folder"==i.getItem(n).type||(n=i.getParentId(n)),i._uploaderFolder=n,void(i._uploadPopup?(i._uploadPopup.destructor(),C(i),I(i),i._uploadPopup.show(o,{x:20,y:5})):i._uploader&&i._uploader.fileDialog());var i,n,o},hideTree:function(){var e;this.callEvent("onBeforeHideTree",[])&&((e=this).$$("treeLayout")&&(e.$$("treeLayout").hide(),e.$$("resizer")&&e.$$("resizer").hide(),e.$$("sidePanel")&&e.$$("sidePanel").show()),this.callEvent("onAfterHideTree",[]))},showTree:function(){var e;this.callEvent("onBeforeShowTree",[])&&((e=this).$$("treeLayout")&&(e.$$("treeLayout").show(),e.$$("resizer")&&e.$$("resizer").show(),e.$$("sidePanel")&&e.$$("sidePanel").hide()),this.callEvent("onAfterShowTree",[]))},defaults:e},webix.ProgressBar,webix.IdSpace,webix.ui.layout,webix.TreeDataMove,webix.TreeDataLoader,webix.DataLoader,webix.EventSystem,webix.Settings)});
//# sourceMappingURL=filemanager.min.js.map
